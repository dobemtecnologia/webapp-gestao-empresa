<ion-card>
  <ion-card-header>
    <ion-card-title>Dados do Cliente</ion-card-title>
    <ion-card-subtitle>Informações pessoais e de contato</ion-card-subtitle>
  </ion-card-header>

  <ion-card-content>
    <ion-item>
      <ion-label position="stacked">
        Nome Completo <ion-text color="danger">*</ion-text>
      </ion-label>
      <ion-input
        formControlName="nome"
        placeholder="Digite seu nome completo"
        required>
      </ion-input>
    </ion-item>
    @if (formGroup.get('nome')?.invalid && formGroup.get('nome')?.touched) {
      <ion-text color="danger" class="error-message">
        Nome é obrigatório (mínimo 2 caracteres)
      </ion-text>
    }

    <ion-item>
      <ion-label position="stacked">
        Email <ion-text color="danger">*</ion-text>
      </ion-label>
      <ion-input
        type="email"
        formControlName="email"
        placeholder="seu@email.com"
        required>
      </ion-input>
    </ion-item>
    @if (formGroup.get('email')?.invalid && formGroup.get('email')?.touched) {
      <ion-text color="danger" class="error-message">
        Email inválido
      </ion-text>
    }

    <ion-item>
      <ion-label position="stacked">Telefone/WhatsApp</ion-label>
      <ion-input
        type="tel"
        formControlName="telefone"
        placeholder="(00) 00000-0000">
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">CNPJ (Opcional)</ion-label>
      <ion-input
        type="text"
        formControlName="cnpj"
        placeholder="00.000.000/0000-00"
        maxlength="18"
        (ionInput)="onCNPJInput($event)"
        (keyup.enter)="consultarCNPJ()">
      </ion-input>
      <ion-button
        slot="end"
        fill="clear"
        (click)="consultarCNPJ()"
        [disabled]="isConsultingCNPJ || !formGroup.get('cnpj')?.value">
        @if (isConsultingCNPJ) {
          <ion-spinner name="crescent"></ion-spinner>
        } @else {
          <ion-icon name="search"></ion-icon>
        }
      </ion-button>
    </ion-item>

    @if (formGroup.get('empresaData')?.get('razaoSocial')?.value) {
      <ion-card color="light" class="mt-3">
        <ion-card-header>
          <ion-card-title>Dados da Empresa</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Razão Social:</strong> {{ formGroup.get('empresaData')?.get('razaoSocial')?.value }}</p>
          @if (formGroup.get('empresaData')?.get('nomeFantasia')?.value) {
            <p><strong>Nome Fantasia:</strong> {{ formGroup.get('empresaData')?.get('nomeFantasia')?.value }}</p>
          }
          <p><strong>Situação:</strong> {{ formGroup.get('empresaData')?.get('situacaoCadastral')?.value }}</p>
          @if (setorSugerido) {
            <p><strong>Setor Sugerido:</strong> {{ setorSugerido.nome }}</p>
          }
        </ion-card-content>
      </ion-card>
    }
  </ion-card-content>
</ion-card>

<style>
.error-message {
  display: block;
  padding: 8px 16px;
  font-size: 12px;
}

.mt-3 {
  margin-top: 16px;
}
</style>

