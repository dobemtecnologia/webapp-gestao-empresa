<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Proposta Gerada</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Proposta Gerada</ion-title>
    </ion-toolbar>
  </ion-header>

  @if (isLoading) {
    <div class="loading-container">
      <ion-spinner></ion-spinner>
    </div>
  } @else if (orcamento) {
    <div class="resultado-container">
      <!-- Card de Sucesso -->
      <ion-card class="success-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
            Proposta Gerada com Sucesso!
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>Sua proposta foi gerada e está pronta para ser compartilhada.</p>
        </ion-card-content>
      </ion-card>

      <!-- Resumo de Valores -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Resumo da Proposta</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="valores-resumo">
            <div class="valor-item">
              <span class="valor-label">Valor Total (Tabela):</span>
              <span class="valor-valor">{{ formatarMoeda(orcamento.valorTotalTabela) }}</span>
            </div>
            @if (orcamento.percentualDescontoAplicado && orcamento.percentualDescontoAplicado > 0) {
              <div class="valor-item desconto">
                <span class="valor-label">Desconto Aplicado:</span>
                <span class="valor-valor">-{{ orcamento.percentualDescontoAplicado }}%</span>
              </div>
            }
            <div class="valor-item destaque">
              <span class="valor-label">Valor Final:</span>
              <span class="valor-valor">{{ formatarMoeda(orcamento.valorTotalFechado) }}</span>
            </div>
            @if (orcamento.valorTotalMinimo && orcamento.valorTotalMinimo > 0) {
              <div class="valor-item">
                <span class="valor-label">Valor Mínimo:</span>
                <span class="valor-valor">{{ formatarMoeda(orcamento.valorTotalMinimo) }}</span>
              </div>
            }
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Link Compartilhável -->
      @if (linkCompartilhavel) {
        <ion-card>
          <ion-card-header>
            <ion-card-title>Link Compartilhável</ion-card-title>
            <ion-card-subtitle>Compartilhe esta proposta com sua equipe</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <div class="link-container">
              <ion-item>
                <ion-input [value]="linkCompartilhavel" readonly></ion-input>
                <ion-button slot="end" fill="outline" (click)="copiarLink()">
                  <ion-icon slot="icon-only" name="copy-outline"></ion-icon>
                </ion-button>
              </ion-item>
            </div>
          </ion-card-content>
        </ion-card>
      }

      <!-- Informações do Orçamento -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Informações</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item>
              <ion-label>
                <h3>Status</h3>
                <p>{{ orcamento.status }}</p>
              </ion-label>
            </ion-item>
            @if (orcamento.codigoHash) {
              <ion-item>
                <ion-label>
                  <h3>Código</h3>
                  <p>{{ orcamento.codigoHash }}</p>
                </ion-label>
              </ion-item>
            }
            @if (orcamento.dataValidade) {
              <ion-item>
                <ion-label>
                  <h3>Válido até</h3>
                  <p>{{ formatarData(orcamento.dataValidade) }}</p>
                </ion-label>
              </ion-item>
            }
          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- Botões de Ação -->
      <div class="action-buttons">
        <ion-button 
          expand="block" 
          color="success" 
          size="large"
          (click)="contratarAgora()">
          <ion-icon slot="start" name="card-outline"></ion-icon>
          Contratar Agora
        </ion-button>
        
        <ion-button 
          expand="block" 
          fill="outline" 
          color="success"
          (click)="falarComVendedor()">
          <ion-icon slot="start" name="logo-whatsapp"></ion-icon>
          Falar com Vendedor
        </ion-button>
      </div>
    </div>
  }
</ion-content>
